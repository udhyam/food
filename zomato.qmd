---
title: "Zomato Data Analysis"
author: "**Arpit Arora**, Udhyam Vyapaar"
format: html
editor: visual
date: "2024-08-08"
---

## Context

Analysis of the Zomato Business Reports data for the last 6 months.

**What's Included**:

- Data for **82 vyapaaris** between **_Feb, '24 - Jul, '24_**
- Monthly aggregated data for sales, orders, ratings, etc.
- Supporting details like impressions, ads, discounts, and more

**What's Pending**:

- **Daily orders** data with granular details of distance, ratings, and timings


```{r setup-env, include = FALSE}
# Load Workspace
# -----------------------------------------------------------------------------
# Loading Packages
library(tidyverse)
library(janitor)
library(lubridate)
library(psych)
library(gt)

# Read the data
zomato_data_aug_2024 <- read_csv("data/processed/zomato_aug_2024.csv")

# Clean Data
# -----------------------------------------------------------------------------
# Standardise field names
zomato_data_aug_2024 <- clean_names(zomato_data_aug_2024)

# Clean numeric field types
zomato_data_aug_2024 <- zomato_data_aug_2024 |>
  mutate(bad_orders = as.double(bad_orders),
         online_percent = as.double(online_percent),
         rated_orders = as.double(rated_orders),
         new_users = as.double(new_users),
         repeat_users = as.double(repeat_users),
         orders_with_offers = as.double(orders_with_offers),
         impressions_to_menu = as.double(impressions_to_menu))

# Transform Data
# -----------------------------------------------------------------------------

# Data Labeling
# Define Labels
zomato_avg_data <- zomato_data_aug_2024 |>
  group_by(name) |>
  summarise(mean_orders = mean(delivered_orders),
            mean_sales = mean(sales)) |>
  mutate(order_flag = if_else(mean_orders >= 30, ">=30",
                              if_else((mean_orders < 30 & mean_orders >= 15), ">=15 & <30", "<15"))) |>
  arrange(desc(mean_sales))

# Join to Original data
zomato_data_aug_2024 <- zomato_data_aug_2024 |>
  left_join(zomato_avg_data, by = join_by(name))
```

## Exploratory Analysis

A quick overview of the data and it's key summaries.

```{r summary, echo = FALSE}
# Data Summary
# -----------------------------------------------------------------------------

# Quick Summary
paste0("Mean Sales: ₹", round(mean(zomato_data_aug_2024$sales, na.rm = TRUE), 1))
paste0("Mean Orders: ", round(mean(zomato_data_aug_2024$delivered_orders, na.rm = TRUE), 1))

paste0("Median Sales: ₹", round(median(zomato_data_aug_2024$sales, na.rm = TRUE), 0))
paste0("Median Orders: ", round(median(zomato_data_aug_2024$delivered_orders, na.rm = TRUE), 0))
```

---

Breaking the vyapaari data down into categories based on number of monthly orders received.

The three levels:

- `>=30` - More than one order a day.
- `>=15 & <30` - More than one order every 2 days, but less than one a day.
- `<15` - Less than an order every 2 days.

```{r level-summary, echo = FALSE}
# Level Summary
level_summary <- zomato_avg_data |>
  group_by(order_flag) |>
  summarise(count = n(),
            mean_sales = mean(mean_sales),
            mean_orders = mean(mean_orders)) |>
  arrange(desc(mean_sales)) |>
  rename(`Monthly Orders` = order_flag,
         `# of Vyapaars` = count,
         `Average Sales` = mean_sales,
         `Average Orders` = mean_orders)

level_summary |>
  gt() |>
  tab_header(
    title = md("**Level Wise Summary**"),
    subtitle = md("_Vyapaaris divided into three categories by number of monthly orders._")
  ) |>
  fmt_number(
    columns = `Average Orders`,
    decimals = 1
  ) |>
  fmt_currency(
    columns = `Average Sales`,
    currency = "INR",
    decimals = 1
  )
```

---

A deeper look into the top 10 vyapaaris to identify the skewed data.

**Gowdru Naati Style**:

- One business is receiving 10x the number of orders of the next biggest vyapaari
- Nearly 40% of all online revenue in the programme is generated by one vypaaari

```{r top10-summary, echo = FALSE}
# Top 10 Vyapaaris
top10_summary <- zomato_avg_data |>
  top_n(10, mean_sales) |>
  select(-order_flag) |>
  rename(Restaurant = name,
         `Monthly Orders` = mean_orders,
         `Monthly Sales` = mean_sales)

gt(top10_summary) |>
  tab_header(
    title = md("**Top 10 Vyapaaris**"),
    subtitle = md("_By monthly sales and orders delivered._")
  ) |>
  fmt_number(
    columns = `Monthly Orders`,
    decimals = 1
  ) |>
  fmt_currency(
    columns = `Monthly Sales`,
    currency = "INR",
    decimals = 1
  )
```

Additional observations:

- `30` vyapaaris had an average monthly order value of less than `0.5`
- `21` vyapaaris had an average monthly sales value of `₹0.0`

---

**Gowdru Naati Style** removed from the data analysis to observec trends.

Key trends identified over the six months of data available:

- The number of vyapaaris has nearly quadrupled from `22` to `81`
- Average monthly sales has nearly halved from `₹1,978.0` to `₹1,034.3`
- Average orders has done down by `57%` and average rating by `37%`

```{r mmonthly-summary, echo = FALSE}
# Remove the outlier vyapaari
zomato_data_filtered <- zomato_data_aug_2024 |>
  filter(name != "Gowdru Naati Style")

# Clean average rating field
zomato_data_filtered["average_rating"][zomato_data_filtered["average_rating"] == 0] <- NA

# Monthly Summary
monthly_summary <- zomato_data_filtered |>
  group_by(period) |>
  summarise(count = n_distinct(name),
            total_sales = sum(sales, na.rm = TRUE),
            total_orders = sum(delivered_orders, na.rm = TRUE),
            mean_sales = mean(sales, na.rm = TRUE),
            mean_orders = mean(delivered_orders, na.rm = TRUE),
            average_rating = mean(average_rating, na.rm = TRUE)) |>
  rename(`Month Year` = period,
         `# of Vyapaaris` = count,
         `Total Sales` = total_sales,
         `Total Orders` = total_orders,
         `Average Sales` = mean_sales,
         `Average Orders` = mean_orders,
         `Average Rating`= average_rating)

monthly_summary |>
  gt() |>
  tab_header(
    title = md("**Month Wise Trends**"),
    subtitle = md("_Overall performance of vyapaaris onboarded by Udhyam._")
  ) |>
  fmt_number(
    columns = c(`Average Orders`, `Average Rating`),
    decimals = 1
  ) |>
  fmt_currency(
    columns = c(`Total Sales`, `Average Sales`),
    currency = "INR",
    decimals = 1
  )
```

## Statistical Analysis

Identifying the key factors that are influencing the performance of a vyapaari.

Finding the relationship between different factors of a businesss:

- **Bottomline**: Sales, Orders, Ratings, Bad orders
- **Discoverability**: Impressions, Menu Clicks, Online %, New/Repeat Users
- **Incentives**: Ads spend, Ad sales, Offers, Dicounts

![A correlation matrix between bottomline, discoverability, and incentive variables.](Zomato Correlation.png){width=100%}

#### Directions for further exploration:
---

`#1` - **Bad Orders** are more like to be rated compared than orders

- Positive correlation between Bad Orders and Rated Orders
- Inverse correlation between Bad Orders and Average Rating
- Strong positive correlation between rating and the sales

`#2` - **Spend on Ads and Sales** from Ads are strong indicator of sales

- Strong positive correlation of Ads with Sales and Delivered Orders
- Can the ads be targeting better to region or customers?
- Online Percent is strongly influenced by sales made from ads

`#3` - **Offers and Discounts Given** are strong indicator of increase in Orders

- Strong positive correlation of Offers Delivered Orders
- Does the pricing need to adapt to offer better sustainable discounts?
- Can the street food vyapaaris compete on discounts and sales?

`#4` - **Impression to Menu** conversion a strong indicator for Sales

- A menu click has a stronger correlation to sales conversion than listing view
- Ads and Discounts positively correlated with more menu clicks from listings

`#5` - `[WILDCARD]` **Offers, Discounts and Ads** negatively impact to average ratings?

- Inverse correlation between Average Rating and Ads, Offers and Discounts
- Relationship of offers and discounts to bad orders?

## What Next?

- Further exploring the hypothesis/data behind these 5 questions
- Deeper analysis of the daily orders data for time live inputs
- Qualitative analysis of the bad orders data for comments, reviews, etc.
